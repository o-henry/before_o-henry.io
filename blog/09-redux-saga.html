<!DOCTYPE html><html lang="ko"><head><meta name="viewport" content="width=device-width, initial-scale=1"/><meta charSet="utf-8"/><meta name="Description" content="Personal Blog"/><title>Henry&#x27;s log</title><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/fc00e196a5278a06aea8.css" as="style"/><link rel="stylesheet" href="/_next/static/css/fc00e196a5278a06aea8.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.e3de07479da4f2477dea.js" as="script"/><link rel="preload" href="/_next/static/chunks/d70fd1b25595f0b45425438df4c8a48f991b761f.e7f675c8e0e3e55d570c.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-5c0423c3a3b70e663dcc.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-e1b3c05385fe05756f1d.js" as="script"/><link rel="preload" href="/_next/static/chunks/077d136c4cc06eb080e27ac956956795c124410c.837dddf646bee485fe57.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/blog/09-redux-saga-e0d5235939371da9d979.js" as="script"/><style id="__jsx-2632742570">.hide.jsx-2632742570{display:none;}h1.jsx-2632742570{font-size:1.5rem;font-weight:700;color:var(--color-header);font-family:"Poppins";}.great-title.jsx-2632742570{font-size:3.125rem;text-align:center;color:var(--color-header);}.details.jsx-2632742570 span.jsx-2632742570{color:#bdbdbd;margin-right:1rem;}.details.jsx-2632742570{font-weight:300;margin-bottom:2px;font-size:11pt;line-height:22pt;-webkit-letter-spacing:0.8px;-moz-letter-spacing:0.8px;-ms-letter-spacing:0.8px;letter-spacing:0.8px;font-family:"NotoSansKR-Thin",MalgunGothic;}.date.jsx-2632742570{font-size:15px;}</style></head><body><script>(function() {
	function setInitialColorMode() {
  function getInitialColorMode() {
    const persistedColorPreference = window.localStorage.getItem("theme");
    const hasPersistedPreference = typeof persistedColorPreference === "string";
    /**
     * If the user has explicitly chosen light or dark,
     * use it. Otherwise, this value will be null.
     */

    if (hasPersistedPreference) {
      return persistedColorPreference;
    } // If there is no saved preference, use a media query


    const mql = window.matchMedia("(prefers-color-scheme: dark)");
    const hasMediaQueryPreference = typeof mql.matches === "boolean";

    if (hasMediaQueryPreference) {
      return mql.matches ? "dark" : "light";
    } // default to 'light'.


    return "light";
  }

  const colorMode = getInitialColorMode();
  const root = document.documentElement;
  root.style.setProperty("--initial-color-mode", colorMode); // add HTML attribute if dark mode

  if (colorMode === "dark") document.documentElement.setAttribute("data-theme", "dark");
}
	setInitialColorMode();
})()
</script><div id="__next"><main><div style="display:flex;align-items:center;justify-content:center"><div style="flex:9"><a href="/"><h1 style="font-size:1.125rem">Henry</h1></a></div><div style="flex-shrink:0;width:15px"></div><a href="/blog"><h2 style="font-size:0.825rem">Blog</h2></a><div style="flex-shrink:0;width:15px"></div><a href="/about"><h2 style="font-size:0.825rem">About</h2></a><div style="flex-shrink:0;width:15px"></div><label><input type="checkbox"/><svg width="1em" height="1em" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg" style="position:relative;font-size:25px;top:3.465px"><path d="M11.75 35.417l-1.48 1.479a2.083 2.083 0 000 2.937 2.084 2.084 0 002.938 0l1.48-1.479a2.084 2.084 0 00-2.938-2.937zM10.417 25a2.083 2.083 0 00-2.084-2.083H6.25a2.083 2.083 0 000 4.166h2.083A2.083 2.083 0 0010.417 25zM25 10.417a2.083 2.083 0 002.083-2.084V6.25a2.083 2.083 0 00-4.166 0v2.083A2.083 2.083 0 0025 10.417zm-13.25 4.27a2.084 2.084 0 002.938 0 2.084 2.084 0 000-2.937l-1.48-1.48a2.083 2.083 0 00-2.937 2.938l1.48 1.48zm25 .605a2.084 2.084 0 001.458-.604l1.48-1.48a2.082 2.082 0 10-2.938-2.937l-1.333 1.479a2.083 2.083 0 000 2.938c.367.365.857.58 1.375.604h-.042zm7 7.625h-2.083a2.083 2.083 0 000 4.166h2.083a2.083 2.083 0 000-4.166zM25 39.583a2.083 2.083 0 00-2.083 2.084v2.083a2.083 2.083 0 004.166 0v-2.083A2.083 2.083 0 0025 39.583zm13.25-4.166a2.084 2.084 0 00-2.833 2.833l1.479 1.48a2.084 2.084 0 002.937 0 2.083 2.083 0 000-2.938l-1.583-1.375zM25 13.542A11.458 11.458 0 1036.458 25 11.48 11.48 0 0025 13.542zm0 18.75a7.292 7.292 0 110-14.585 7.292 7.292 0 010 14.585z" fill="#000"></path></svg></label></div><div class="content"><h1 class="jsx-2632742570 great-title">Redux Saga</h1><div class="jsx-2632742570 details"><span class="jsx-2632742570 hide">May 30, 2021</span><span class="jsx-2632742570 hide">10 min read</span></div><article><div style="margin-top:4rem;font-family:Poppins, NotoSansKR-Thin, MalgunGothic;font-size:11pt;line-height:22pt;letter-spacing:.8px"><p>프론트엔드를 크게 3가지로 나누어 보면,</p><p><strong>UI/UX로 이루어진 VIEW ・ 상태 관리 ・ API ・ CRUD 등의 사이드 이펙트 요소</strong>들 로 나눌 수 있습니다.</p><br/><p><strong>VIEW</strong></p><p>리액트에서 눈에 보이는 화면은 one-way binding 을 통해 이루어집니다.
뷰는 상태에 따른 값을 보여줍니다. 상태가 변하면 해당 부분만을 바꾸며 그저 보여주기만 합니다.</p><br/><p><strong>상태 관리</strong></p><p>그럼 어떻게 뷰의 상태를 바꿀 수 있을까?</p><p>이를 위해서 리액트는 자체적으로 상태 관리를 위한 기능들을 제공해주고 있습니다.</p><p>기존 state는 얕은 상태관리 로직에 이점이 있지만, 앱이 거대해질 수록 컴포넌트 관리가 복잡해지면서 prop-drilling 등의 문제가 일어났습니다. 이를 해결하기 위해 context등의 새로운 기능이 추가 되었습니다.
하지만 context역시 특정 컴포넌트에 한정된다는 문제가 있었습니다.</p><hr/><p>이러한 문제점을 해결하기 위해 나타난 라이브러리 / 패턴이 redux 입니다. redux는 Flux 패턴의
방식과 비슷 하게 개발된 상태 관리 도구 입니다. 모든 상태를 global한 store에 저장하여 어디서든
접근/사용 할 수 있게 함으로써, 개발자가 <strong>상태관리와 ・ VIEW</strong>에 대한 로직을 별개로 고민할
수 있게 했습니다.</p><br/><p><strong>SIDE EFFECT</strong></p><p>개발자는 예측할 수 없는 상황을 싫어합니다.
간단한 예로 순수함수는 항상 같은 입력에는 같은 출력을 반환해야 하는데, 외부 요소에 의해 아웃풋이 변경된다거나 하는 등의 상황이 있습니다. 이러한 상황을 일으키는 걸 사이드 이펙트라고 합니다.
리액트에서는 사이드 이펙트를 처리하라고 <code>useEffect</code> 등의 함수를 사용하도록 하는데, 일반적으로 DB에 데이터를 저장한다거나 등의 일들을 위에서 처리합니다.</p><br/><p><strong>redux-saga</strong></p><p>redux-saga는 위의 <strong>사이드 이펙트</strong>를 전담하는 미들웨어 입니다.</p><hr/><p><strong>saga의 작동원리</strong></p><p>먼저, saga는 ES6의 Generator 를 사용합니다. Generator 는 <code>yield</code> 키워드 를 사용하는데, 해당 키워드를 만나면 동작을 멈추고, <code>next</code>가 와야 다음 동작으로 넘어갑니다.</p><hr/><p>UI 컴포넌트는 action 을 dispatch 함으로써 어떠한 일이 발생했다는 정보를 알립니다.
모든 것은 saga 내부에 캡슐화 되어야 합니다. 실제 Task를 동작시키기 위해 <code>action(FETCH_REQUEST)</code> 을 <strong>watch</strong> 하는 saga를 만들어야 합니다.</p><div class="blog-post"><div class="language-ts"><pre class="language-ts"><span class="token comment">// UI components notify action to saga..</span>
<span class="token comment">// api 요청을 하게 되면, pending / resolve / reject 의 상태를 고려하여, 구성합니다.</span>
<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">&#x27;FETCH_REQUEST&#x27;</span><span class="token punctuation">,</span>
    url<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token spread operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// saga</span>
<span class="token keyword">import</span> <span class="token imports"><span class="token punctuation">{</span> take<span class="token punctuation">,</span> call<span class="token punctuation">,</span> put <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">&quot;redux-saga/effects&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// The watcher: watch actions and coordinate worker tasks</span>
<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">watchFetchRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// &#x27;FETCH_REQEUST&#x27; 액션이 전달될때마다, fetchUrl 콜백함수를 실행 합니다.</span>
    <span class="token comment">// saga middleware에서 해당 action을 계속 주시하고 있습니다 ...</span>
    <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token string">&quot;FETCH_REQUEST&quot;</span><span class="token punctuation">,</span> fetchUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// or</span>
    <span class="token comment">// const action = yield take(&#x27;FETCH_REQUEST&#x27;);</span>
    <span class="token comment">// yield fork(fetchUrl, action.url);</span>
<span class="token punctuation">}</span>

<span class="token comment">// The worker: perform the requested task</span>
<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">fetchUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Generator</span> <span class="token punctuation">{</span>
  <span class="token comment">// call 함수의 Promise를 반환하는 함수(fetch)를 인자로하여,실행한 후 대기합니다.</span>
  <span class="token comment">// resolve가 되면 generator 함수를 next 처럼 진행시킵니다.</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>fetch<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 비동기 요청이 끝나면, put을 통해 새로운 액션을 스토어에 전달합니다.</span>
  <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">&quot;FETCH_SUCCESS&quot;</span><span class="token punctuation">,</span>
    data<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre></div></div></div><br/><hr style="width:15px;border:0.325px solid gray;margin-top:1.125rem;margin-bottom:1.125rem"/><h5>참조</h5><p><a href="https://survivejs.com/blog/redux-saga-interview/">redux-saga</a></p></article></div></main><footer style="font-size:0.625rem;font-weight:200;margin-top:2.625rem;margin-bottom:2.5rem">2021 © Henry</footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/blog/09-redux-saga","query":{},"buildId":"zxzZpvociAAslyqu-AonO","nextExport":true,"autoExport":true,"isFallback":false}</script><script nomodule="" src="/_next/static/chunks/polyfills-3fa9f7fa683372911569.js"></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.e3de07479da4f2477dea.js" async=""></script><script src="/_next/static/chunks/d70fd1b25595f0b45425438df4c8a48f991b761f.e7f675c8e0e3e55d570c.js" async=""></script><script src="/_next/static/chunks/main-5c0423c3a3b70e663dcc.js" async=""></script><script src="/_next/static/chunks/pages/_app-e1b3c05385fe05756f1d.js" async=""></script><script src="/_next/static/chunks/077d136c4cc06eb080e27ac956956795c124410c.837dddf646bee485fe57.js" async=""></script><script src="/_next/static/chunks/pages/blog/09-redux-saga-e0d5235939371da9d979.js" async=""></script><script src="/_next/static/zxzZpvociAAslyqu-AonO/_buildManifest.js" async=""></script><script src="/_next/static/zxzZpvociAAslyqu-AonO/_ssgManifest.js" async=""></script></body></html>